<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Termtrainer ‚Äì Terme zusammenfassen</title>
<style>
  body {
    font-family: system-ui, Arial, sans-serif;
    background: linear-gradient(to bottom right,#f0f4ff,#e0f7fa);
    text-align: center;
    margin: 0;
    padding: 20px;
  }
  h1 { color:#333; margin:10px 0; font-size:1.8em; }
  #task { font-size:1.6em; margin:15px auto; white-space:pre-line; }
  #result { font-size:1.1em; margin:10px; color:#000; font-weight:400; }
  #score { font-size:1.1em; margin:8px; color:#333; }
  #levelDisplay { font-weight:bold; color:#007bff; margin-bottom:5px; }

  #progressContainer {
    width:80%; max-width:400px; height:20px;
    background-color:#ddd; border-radius:10px;
    margin:10px auto 20px; overflow:hidden; display:flex;
  }
  .progress-segment {
    height:100%; flex:1; background:#ddd;
    transition:background-color .25s ease;
  }

  input {
    padding:10px; font-size:1.2em; width:80%; max-width:360px;
    text-align:center; border-radius:8px; border:1px solid #aaa;
  }
  input:focus { outline:none; border-color:#007bff; }
  button {
    background:#007bff; color:white; border:none;
    padding:10px 18px; margin:6px; font-size:1em;
    border-radius:8px; cursor:pointer;
  }
  button:hover { background:#0056b3; }
</style>
</head>
<body>
<h1>Termtrainer ‚Äì Terme zusammenfassen</h1>
<div id="levelDisplay">Level 1: Gleiche Terme</div>
<div id="score">Lade...</div>
<div id="progressContainer"></div>

<div id="task">...</div>

<input type="text" id="answer" placeholder="Zusammengefasster Term" autocomplete="off" spellcheck="false"><br>
<button id="checkBtn">Pr√ºfen</button>
<button id="newBtn">Neue Aufgabe</button>

<p id="result"></p>

<p style="font-size:0.8em;color:#555;margin-top:40px;">
Diese Seite speichert keine pers√∂nlichen Daten und l√§uft vollst√§ndig lokal im Browser.<br>
¬© 2025 Termtrainer ‚Äì Add/Sub Levels
</p>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const answerEl = document.getElementById("answer");
  const checkBtn = document.getElementById("checkBtn");
  const newBtn = document.getElementById("newBtn");
  const taskEl = document.getElementById("task");
  const resultEl = document.getElementById("result");
  const scoreEl = document.getElementById("score");
  const levelDisplay = document.getElementById("levelDisplay");
  const progressContainer = document.getElementById("progressContainer");

  const VARS = ['a','b','m','n','x','y'];
  const randomChoice = a => a[Math.floor(Math.random()*a.length)];
  const randomCoeff = (max=5) => Math.floor(Math.random()*max)+1;
  const sgn = () => Math.random()<0.5 ? -1 : +1;

  // Status
  let level = 1, round = 1, totalRounds = 10, score = 0;
  let correctSolution = "";
  let firstTry = true;
  let answered = false;
  const segments = [];

  // Fortschrittsbalken initialisieren
  function initProgressBar() {
    progressContainer.innerHTML = "";
    segments.length = 0;
    for (let i=0;i<totalRounds;i++) {
      const seg = document.createElement("div");
      seg.className = "progress-segment";
      progressContainer.appendChild(seg);
      segments.push(seg);
    }
  }

  const LEVEL_NAMES = [
    "Level 1: Gleiche Terme",
    "Level 2: Verschiedene Variablen",
    "Level 3: Klammerausdr√ºcke"
  ];

  // ---------- Hilfsfunktionen ----------
  function cleanOnes(str) {
    // Entferne "1x" ‚Üí "x" und "-1x" ‚Üí "-x"
    return str
      .replace(/(^|[+\-])1([a-z])/g, '$1$2')
      .replace(/(^|[+\-])0[a-z]\b/g, ''); // 0x entfernen
  }

  function formatTerm(coeff, variable="") {
    if (variable === "") return `${coeff}`;
    if (coeff === 1) return `${variable}`;
    if (coeff === -1) return `-${variable}`;
    return `${coeff}${variable}`;
  }

  // ---------- Aufgaben ----------
  function createLevel1Task(){
    const v = randomChoice(VARS);
    const c1 = randomCoeff()*sgn();
    const c2 = randomCoeff()*sgn();
    const term = `${formatTerm(c1,v)} ${c2>=0?'+':'-'} ${formatTerm(Math.abs(c2),v)}`;
    const sum = c1 + c2;
    correctSolution = (sum===0) ? "0" : formatTerm(sum,v);
    return `${term} = ?`;
  }

  function createLevel2Task(){
    const v1 = randomChoice(VARS);
    let v2 = randomChoice(VARS); while (v2===v1) v2 = randomChoice(VARS);
    const c1 = randomCoeff()*sgn();
    const c2 = randomCoeff()*sgn();
    const c3 = randomCoeff()*sgn();
    const term = `${formatTerm(c1,v1)} ${c2>=0?'+':'-'} ${formatTerm(Math.abs(c2),v2)} ${c3>=0?'+':'-'} ${formatTerm(Math.abs(c3),v1)}`;
    const sum1 = c1 + c3;
    let res = "";
    if (sum1 !== 0) res += formatTerm(sum1,v1);
    if (c2 !== 0) {
      res += (res ? (c2>0 ? " + " : " - ") : (c2>0 ? "" : "-")) + formatTerm(Math.abs(c2),v2);
    }
    correctSolution = res || "0";
    return `${term} = ?`;
  }

  function createLevel3Task(){
    const v = randomChoice(VARS);
    const outer = (Math.floor(Math.random()*9) - 4);
    const cVar = randomCoeff()*sgn();
    const cNum = randomCoeff()*sgn();
    const op = Math.random()<0.5 ? '+' : '-';
    const task = `(${outer}) ${op} (${formatTerm(cVar,v)} ${cNum>=0?'+':'-'} ${Math.abs(cNum)})`;

    const varPart = (op==='+') ? cVar : -cVar;
    const numPart = outer + ((op==='+') ? cNum : -cNum);

    let res = "";
    if (varPart !== 0) res += formatTerm(varPart,v);
    if (numPart !== 0) {
      res += (res ? (numPart>0 ? " + " : " - ") : (numPart>0 ? "" : "-")) + Math.abs(numPart);
    }
    correctSolution = res || "0";
    return `${task} = ?`;
  }

  // ---------- Levelsteuerung ----------
  function nextLevel(){
    if (score>=8 && level<3) {
      level++;
      alert(`üéØ Level ${level-1} geschafft! Weiter mit ${LEVEL_NAMES[level-1]}.`);
    } else if (score>=8 && level===3) {
      alert("üèÜ Alle Level geschafft! Super!");
    } else {
      alert(`Level ${level} beendet mit ${score}/${totalRounds} Punkten. Versuch es nochmal!`);
    }
    round=1; score=0;
    segments.forEach(s=>s.style.backgroundColor="#ddd");
    newTask();
  }

  function newTask(){
    resultEl.innerText=""; answerEl.value="";
    firstTry = true; answered = false;
    levelDisplay.innerText = LEVEL_NAMES[level-1];

    if (round>totalRounds) {
      resultEl.style.color="green";
      resultEl.innerHTML = `üéâ Level fertig!<br>Endstand: ${score}/${totalRounds}`;
      nextLevel(); return;
    }

    let aufgabe;
    switch(level){
      case 1: aufgabe=createLevel1Task(); break;
      case 2: aufgabe=createLevel2Task(); break;
      case 3: aufgabe=createLevel3Task(); break;
    }
    taskEl.innerText = aufgabe;
    scoreEl.innerText = `Aufgabe ${round} von ${totalRounds} ‚Äì Punkte: ${score}`;
  }

  // ---------- Pr√ºfen ----------
  function check(){
    const input = cleanOnes(answerEl.value.trim().replace(/\s+/g,''));
    const correct = cleanOnes(correctSolution.replace(/\s+/g,''));

    if (!input) { resultEl.style.color="#555"; resultEl.innerText="Bitte gib eine L√∂sung ein."; return; }

    if (answered) { // keine neue F√§rbung
      if (input===correct) {
        resultEl.style.color="green";
        resultEl.innerText="‚úÖ Richtig ‚Äì aber kein Punkt mehr";
      } else {
        resultEl.style.color="#000";
        resultEl.innerHTML = `‚ùå Falsch! Richtige L√∂sung: <b>${correctSolution}</b>`;
      }
      return;
    }

    answered = true;
    if (input===correct) {
      resultEl.style.color="green";
      if (firstTry) { score++; segments[round-1].style.backgroundColor="#4caf50"; resultEl.innerText="‚úÖ Richtig! (+1 Punkt)"; }
      else { resultEl.innerText="‚úÖ Richtig ‚Äì aber kein Punkt mehr"; }
    } else {
      resultEl.style.color="#000";
      if (firstTry) segments[round-1].style.backgroundColor="#d9534f";
      resultEl.innerHTML = `‚ùå Falsch! Richtige L√∂sung: <b>${correctSolution}</b>`;
    }

    firstTry=false;
    round++;
    scoreEl.innerText = `Aufgabe ${Math.min(round,totalRounds)} von ${totalRounds} ‚Äì Punkte: ${score}`;
  }

  checkBtn.addEventListener("click", check);
  newBtn.addEventListener("click", newTask);
  answerEl.addEventListener("keydown", e => { if (e.key==="Enter") check(); });

  initProgressBar();
  newTask();
});
</script>
</body>
</html>
