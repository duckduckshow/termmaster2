<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Termtrainer ‚Äì Terme zusammenfassen</title>
<style>
  body {
    font-family: system-ui, Arial, sans-serif;
    background: linear-gradient(to bottom right,#f0f4ff,#e0f7fa);
    text-align: center;
    margin: 0;
    padding: 20px;
  }
  h1 { color:#333; margin:10px 0; font-size:1.8em; }
  #task { font-size:1.6em; margin:15px auto; white-space:pre-line; }
  #result { font-size:1.1em; margin:10px; color:#000; font-weight:400; }
  #score { font-size:1.1em; margin:8px; color:#333; }
  #levelDisplay { font-weight:bold; color:#007bff; margin-bottom:5px; }

  #progressContainer {
    width:80%; max-width:400px; height:20px;
    background-color:#ddd; border-radius:10px;
    margin:10px auto 20px; overflow:hidden; display:flex;
  }
  .progress-segment {
    height:100%; flex:1; transition:background-color 0.3s ease;
  }

  input {
    padding:10px; font-size:1.2em; width:80%; max-width:300px;
    text-align:center; border-radius:8px; border:1px solid #aaa;
  }
  input:focus { outline:none; border-color:#007bff; }
  button {
    background:#007bff; color:white; border:none;
    padding:10px 18px; margin:6px; font-size:1em;
    border-radius:8px; cursor:pointer;
  }
  button:hover { background:#0056b3; }
</style>
</head>
<body>
<h1>Termtrainer ‚Äì Terme zusammenfassen</h1>
<div id="levelDisplay">Level 1: Gleiche Terme</div>
<div id="score">Lade...</div>
<div id="progressContainer"></div>
<div id="task">...</div>
<input type="text" id="answer" placeholder="Zusammengefasster Term" autocomplete="off" spellcheck="false"><br>
<button id="checkBtn">Pr√ºfen</button>
<button id="newBtn">Neue Aufgabe</button>
<p id="result"></p>
<p style="font-size:0.8em;color:#555;margin-top:40px;">
Diese Seite speichert keine pers√∂nlichen Daten und l√§uft vollst√§ndig lokal im Browser.<br>
¬© 2025 Termtrainer ‚Äì Add/Sub Levels
</p>

<script>
document.addEventListener("DOMContentLoaded",()=>{

  const answerEl=document.getElementById("answer");
  const checkBtn=document.getElementById("checkBtn");
  const newBtn=document.getElementById("newBtn");
  const taskEl=document.getElementById("task");
  const resultEl=document.getElementById("result");
  const scoreEl=document.getElementById("score");
  const levelDisplay=document.getElementById("levelDisplay");
  const progressContainer=document.getElementById("progressContainer");

  const VARS=['a','b','m','n','x','y'];
  const randomChoice=a=>a[Math.floor(Math.random()*a.length)];
  const randomSign=()=>Math.random()<0.5?'-':'+';
  const randomCoeff=()=>Math.floor(Math.random()*5)+1;

  let level=1, correctSolution="", round=1, score=0, totalRounds=10;
  let firstTry=true, answered=false;
  const segments=[];

  function initProgressBar(){
    progressContainer.innerHTML="";
    segments.length=0;
    for(let i=0;i<totalRounds;i++){
      const seg=document.createElement("div");
      seg.className="progress-segment";
      seg.style.backgroundColor="#ddd";
      progressContainer.appendChild(seg);
      segments.push(seg);
    }
  }

  const LEVEL_NAMES=[
    "Level 1: Gleiche Terme",
    "Level 2: Verschiedene Variablen",
    "Level 3: Klammerausdr√ºcke"
  ];

  // --- Aufgaben erstellen ---
  function createLevel1Task(){
    const coeff1=randomCoeff()*(Math.random()<0.5?-1:1);
    const coeff2=randomCoeff()*(Math.random()<0.5?-1:1);
    const variable=randomChoice(VARS);
    const term=`${coeff1}${variable} ${coeff2>=0?'+':'-'} ${Math.abs(coeff2)}${variable}`;
    const sum=coeff1+coeff2;
    correctSolution=(sum===0)?"0":`${sum}${variable}`;
    return `${term} = ?`;
  }

  function createLevel2Task(){
    const coeff1=randomCoeff()*(Math.random()<0.5?-1:1);
    const coeff2=randomCoeff()*(Math.random()<0.5?-1:1);
    const coeff3=randomCoeff()*(Math.random()<0.5?-1:1);
    const v1=randomChoice(VARS);
    let v2=randomChoice(VARS);
    while(v2===v1)v2=randomChoice(VARS);
    const term=`${coeff1}${v1} ${coeff2>=0?'+':'-'} ${Math.abs(coeff2)}${v2} ${coeff3>=0?'+':'-'} ${Math.abs(coeff3)}${v1}`;
    const sum1=coeff1+coeff3;
    let res="";
    if(sum1!==0)res+=`${sum1}${v1}`;
    if(coeff2>0)res+=`${res?" + ":""}${coeff2}${v2}`;
    else if(coeff2<0)res+=`${res?" - ":""}${Math.abs(coeff2)}${v2}`;
    correctSolution=res;
    return `${term} = ?`;
  }

  function createLevel3Task(){
    // einfache Klammern: (-8) - (x - 4) oder (5) + (3x - 2)
    const useX=Math.random()<0.5;
    const v=useX?"x":randomChoice(VARS);
    const n1=Math.floor(Math.random()*9)-4; // Zahl au√üerhalb
    const c1=randomCoeff()*(Math.random()<0.5?-1:1);
    const c2=randomCoeff()*(Math.random()<0.5?-1:1);
    const sign=Math.random()<0.5?'+':'-';
    const term=`(${n1}) ${sign} (${c1}${v} ${c2>=0?'+':'-'} ${Math.abs(c2)})`;

    // Ausmultiplizieren (Klammern aufl√∂sen)
    let result="";
    if(sign==='+'){
      result=`${n1>=0?'+':''}${n1} + ${c1}${v} ${c2>=0?'+':'-'} ${Math.abs(c2)}`;
    } else {
      result=`${n1>=0?'+':''}${n1} - ${c1}${v} ${c2>=0?'+':'-'} ${Math.abs(c2)}`;
    }

    // Zusammenfassen (Zahlen)
    let numPart=n1+(sign==='+'?c2:-c2);
    correctSolution=`${(sign==='+'?c1:-c1)}${v} ${numPart>=0?'+':'-'} ${Math.abs(numPart)}`;
    return `${term} = ?`;
  }

  // --- Levelabh√§ngig ---
  function newTask(){
    resultEl.innerText="";answerEl.value="";firstTry=true;answered=false;
    levelDisplay.innerText=LEVEL_NAMES[level-1];
    if(round>totalRounds){
      resultEl.style.color="green";
      resultEl.innerHTML=`üéâ Level fertig!<br>Endstand: ${score}/${totalRounds}`;
      nextLevel();return;
    }

    let aufgabe;
    switch(level){
      case 1:aufgabe=createLevel1Task();break;
      case 2:aufgabe=createLevel2Task();break;
      case 3:aufgabe=createLevel3Task();break;
    }
    taskEl.innerText=aufgabe;
    scoreEl.innerText=`Aufgabe ${round} von ${totalRounds} ‚Äì Punkte: ${score}`;
  }

  function nextLevel(){
    if(score>=8 && level<3){level++;alert(`üéØ Level ${level-1} geschafft! Weiter mit ${LEVEL_NAMES[level-1]}.`);}
    else if(score>=8 && level===3){alert("üèÜ Alle Level geschafft! Super!");}
    else{alert(`Level ${level} beendet mit ${score}/${totalRounds} Punkten. Versuch es nochmal!`);}
    round=1;score=0;segments.forEach(s=>s.style.backgroundColor="#ddd");newTask();
  }

  function checkAnswer(){
    const input=answerEl.value.trim().replace(/\s+/g,'');
    const correct=correctSolution.replace(/\s+/g,'');
    if(!input){resultEl.innerText="Bitte gib eine L√∂sung ein.";return;}

    if(input===correct){
      resultEl.style.color="green";
      if(firstTry){score++;segments[round-1].style.backgroundColor="#4caf50";}
      resultEl.innerText="‚úÖ Richtig!";
    }else{
      resultEl.style.color="#000";
      if(firstTry)segments[round-1].style.backgroundColor="#d9534f";
      resultEl.innerHTML=`‚ùå Falsch! Richtig: <b>${correctSolution}</b>`;
    }

    firstTry=false;
    round++;
    scoreEl.innerText=`Aufgabe ${Math.min(round,totalRounds)} von ${totalRounds} ‚Äì Punkte: ${score}`;
  }

  checkBtn.addEventListener("click",checkAnswer);
  newBtn.addEventListener("click",newTask);
  answerEl.addEventListener("keydown",e=>{if(e.key==="Enter")checkAnswer();});
  initProgressBar();
  newTask();
});
</script>
</body>
</html>
